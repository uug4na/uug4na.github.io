<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>
&#34;PostMessage XSS&#34;-н тухай | 
</title>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="PostMessage-ийг буруу хэрэгжүүлэхээс үүдэлтэй DOM-based XSS эмзэг байдлын тайлбар, PoC ба хамгаалалт.">

<meta name="generator" content="Hugo 0.151.0">


<link rel="canonical" href="//localhost:1313/posts/postmessage/" >




<link href="/css/style.min.66302fa6c122ab7804faa4bd6465554ac4d746c25294af622826d0445b79ab94.css" rel="stylesheet">




</head>

<body>

    <div class="flexWrapper">
        <header class="headerWrapper">
    <div class="header">
        <div>
            <a class="terminal" href="//localhost:1313/">
                <span>uug4na@github.io ~ $</span>
            </a>
        </div>
        <input class="side-menu" type="checkbox" id="side-menu">
        <label class="hamb" for="side-menu"><span class="hamb-line"></span></label>
        <nav class="headerLinks">
            <ul>
                
                <li>
                    <a href="//localhost:1313/about/" title="" >
                        ~/about</a>
                </li>
                
                <li>
                    <a href="//localhost:1313/posts" title="" >
                        ~/posts</a>
                </li>
                
            </ul>
        </nav>
    </div>
</header>


        <div class="content">
            <main class="main">
                
<div class="postWrapper">
    <h1>&#34;PostMessage XSS&#34;-н тухай</h1>
    
    	<p>PostMessage-ийг буруу хэрэгжүүлэхээс үүдэлтэй DOM-based XSS эмзэг байдлын тайлбар, PoC ба хамгаалалт.</p>
    

    
    
    
    

    
    
    
    
    

    
    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    <section class="postMetadata">
        <dl>
            
                
<dt>tags</dt>
<dd><span></span>
    <a href="/tags/xss/">#Xss</a><span></span>
    <a href="/tags/postmessage/">#Postmessage</a><span></span>
    <a href="/tags/web-security/">#Web-Security</a><span></span>
    <a href="/tags/iframe/">#Iframe</a><span></span>
    <a href="/tags/sop/">#Sop</a></dd>
            
            
            
            
                <dt>published</dt>
                 
                 
                 <dd><time datetime="2025-10-14">2025-10-14</time></dd>
            
            
                <dt>reading time</dt>
                <dd>3 minutes</dd>
            
        </dl>
    </section>
    
    <div>
        <h2 id="postmessage-гэж-юу-вэ--not-finished-">&ldquo;PostMessage&rdquo; гэж юу вэ? ( not finished )</h2>
<p>Юун түрүүнд <strong>developer</strong>-ийн өнцгөөс <em>яагаад, хэрхэн</em> ашиглагддагийг харъя. Зарим вебсайт <strong>ADS</strong>-ийг <code>iframe</code> ашиглан байршуулдаг жишээг доор харуулав.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- Зар байршуулж буй жишээ код --&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">iframe</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://youradurl.com&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;700&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;500&#34;</span>&gt;&lt;/<span style="color:#f92672">iframe</span>&gt;
</span></span></code></pre></div><p>Мөн Cross-Origin Communication–д (өөр өөр origin/domain хооронд өгөгдөл солилцох) өргөн хэрэглэгддэг. Жишээлбэл: төлбөрийн системтэй холболт, OAuth, гуравдагч талын үйлчилгээ (AD, виджет гэх мэт).</p>
<p>Эндээс Same-Origin Policy (SOP) хөндөгдөнө. SOP нь өөр өөр origin-той window/frame-үүд бие биенийхээ resource руу шууд хандахыг хязгаарладаг. Origin-г дараах 3-аар тодорхойлно:</p>
<ul>
<li>protocol (http:// vs https://)</li>
<li>hostname (domain)</li>
<li>port</li>
</ul>
<p>Дээрх 3-ын аль нэг нь зөрвөл same-origin биш болно. Шууд тайлбар: 
<a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener">MDN — Same-origin policy</a>
</p>
<p>Window ба Iframe</p>
<p>iframe нь өөр web page-ийг өөрийн хуудсан дотор “нэвтрүүлж” ажиллуулна.</p>
<p>Хэрэв адилхан origin бол дуудаж буй хуудас (parent) нь дуудагдсан хуудсандаа (child) JS-ээр нөлөөлж чадна (DOM-д бичих, унших).</p>
<p>Олон сайтууд X-Frame-Options: SAMEORIGIN эсвэл Content-Security-Policy: frame-ancestors &lsquo;self&rsquo; &hellip; ашиглаж iframe дотор нэвтрүүлэхийг хязгаарладаг.</p>
<p>Одоо харин “PostMessage XSS” рүү</p>
<p>Эмзэг байдлыг хайхдаа тухайн сайт Web Messaging ашиглаж байгаа эсэхийг шалгана:</p>
<p>window.postMessage(message, targetOrigin, transfer?)</p>
<p>эсвэл addEventListener(&ldquo;message&rdquo;, handler) ашигласан эсэх.</p>
<p>Жишээ хэлбэр:</p>
<p>// message listener суулгасан байж болно
addEventListener(&ldquo;message&rdquo;, function (event) {
// энд ирсэн мессежийг handle хийж байна
});</p>
<p>// илгээгч тал
window.postMessage(message, targetOrigin /*, transfer */);</p>
<p>(Илрүүлэхэд туслах энгийн арга: кодуудаас &ldquo;message&rdquo; listener, postMessage( мөрүүдийг хайх; эсвэл өөрийн ашигладаг postMessage tracker/extension-ээ ажиллуулах.)</p>
<p>Яаж эмзэг болдог вэ?</p>
<p>Ихэвчлэн орж ирсэн мессежийг буруу handle хийж, origin шалгахгүй, эсвэл event.data-г sanitize хийхгүйгээр innerHTML зэрэг аргаар DOM руу шууд бичих үед.</p>
<p>⚠️ DOM руу шууд бичих сайн биш аргууд (sanitize-гүй бол):</p>
<p>element.innerHTML = &hellip;</p>
<p>element.outerHTML = &hellip;</p>
<p>element.insertAdjacentHTML(&hellip;)</p>
<p>document.write(&hellip;)</p>
<p>PoC — Эмзэг код ба халдагч</p>
<p>Доорх нь ойлгомжтой, минимал PoC. (Таны дурдсанчлан vulnerable.html-ийг өөр домэйн дээр, attacker.html-ийг localhost дээр байршуулж болно.)</p>
<p>vulnerable.html (эмзэг тал)
&lt;!doctype html&gt;</p>
<!-- raw HTML omitted -->
<pre><code>&lt;script&gt;
  // ⚠️ origin ШАЛГАХГҮЙ, sanitize ХИЙХГҮЙ
  window.addEventListener(&quot;message&quot;, function (event) {
    // АЮУЛТАЙ: шууд innerHTML-д бичиж байна
    document.getElementById(&quot;message&quot;).innerHTML = event.data;
  });
&lt;/script&gt;
</code></pre>
<!-- raw HTML omitted -->
<p>attacker.html (халдагч тал)
&lt;!doctype html&gt;</p>
<!-- raw HTML omitted -->
<pre><code>&lt;script&gt;
  const vuln = window.open(&quot;https://victim.example.com/vulnerable.html&quot;, &quot;vuln&quot;);

  document.getElementById(&quot;pwn&quot;).onclick = () =&gt; {
    const payload = `&lt;img src=x onerror=&quot;alert('XSS from ' + location.origin)&quot;&gt;`;
    // ⚠️ targetOrigin='*' - санаатайгаар сул орхиж байна (демо)
    vuln.postMessage(payload, &quot;*&quot;);
  };
&lt;/script&gt;
</code></pre>
<!-- raw HTML omitted -->
<p>Энд эмзэг тал ямар ч origin шалгаагүй тул attacker.html-ээс ирсэн мессежийг DOM-доо payload хэлбэрээр цутгаж, XSS үүсч байна.</p>
<p>Таны PoC линк: 
<a href="https://uug4na.me/poc/index.html" target="_blank" rel="noopener">https://uug4na.me/poc/index.html</a>
 (хэрэв амьд жишээ ажиллуулж байгаа бол эндээс харуулж болно.)</p>
<p>Зөв хамгаалалт</p>
<p>Origin шалгах — итгэсэн origin-уудаас ирсэн мессежийг л зөвшөөр.</p>
<p>Агуулгыг текстээр оруулах — HTML биш, textContent:</p>
<p>window.onmessage = function (event) {
// 1) Зөвшөөрөгдсөн origin эсэхийг баталгаажуул
if (event.origin !== &ldquo;
<a href="https://safe-origin.com" target="_blank" rel="noopener">https://safe-origin.com</a>
&rdquo;) return;</p>
<p>// 2) DOM руу текст хэлбэрээр оруул (XSS байхгүй)
const messageDiv = document.getElementById(&ldquo;message&rdquo;);
const el = document.createElement(&ldquo;div&rdquo;);
el.textContent = event.data; // ← textContent = аюулгүй
messageDiv.appendChild(el);
};</p>
<p>Илгээгч талд postMessage-ийн targetOrigin-ыг * биш, яг хүлээгдсэн origin болгож тохируулах.</p>
<p>CSP (Content Security Policy) ашиглан inline script-ийг хориглох, зөвшөөрөгдсөн эх сурвалжийг л нээх.</p>
<p>Жишээ кейсүүд (ил болгоод тайлагнагдсан)</p>
<p>PlayStation — reflected XSS via postMessage (HackerOne disclosed)</p>
<p>HackerOne — DOM-based XSS in Marketo form handler (disclosed)</p>
<p>Upserve — DOM-based XSS via postMessage (disclosed)</p>
<p>Эдгээр нь origin шалгалт дутуу/буруу, мөн DOM-руу sanitize-гүй бичих зэрэг нийтлэг алдаанаас үүдсэн.</p>
<p>Дүгнэлт</p>
<p>postMessage өөрөө буруу биш; мессежийг хэрхэн handle хийж байгаа нь аюул үүсгэнэ.</p>
<p>Origin-оо шалга, sanitize-гүй HTML бичихээс зайлсхий, targetOrigin-оо нарийвчил.</p>
<p>Хэрэв хоёр тал өөр origin бол SOP-ийн хүрээнд зөвшөөрөл, бодлогуудаа (CSP, frame-ancestors, XFO) зөв тохируул.</p>
<p>Ашигласан эх сурвалж</p>
<p>MDN — Same-origin policy: 
<a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy</a>
</p>
<p>(Та өөрийн PoC/тайлангийн линкүүдээ энд нэмээрэй.)</p>

    </div>
</div>

            </main>
        </div>


        <footer class="footer">
    
        <span>
            © 2025 , Built with
            <a href="https://gohugo.io" class="footerLink">Hugo</a> and
            <a href="https://github.com/LordMathis/hugo-theme-nightfall" class="footerLink">Nightfall</a> theme
        </span>
    
</footer>
    </div>

</body>

</html>
